version: '{build} {branch}'

image: [Visual Studio 2022] # Windows Server 2019

configuration: [CLANG64,UCRT64,MINGW64]

environment:
  MSYSTEM: "%CONFIGURATION%"

init:
  - appveyor version
  - cmd: ver
  - cmd: systeminfo | findstr /B /C:"OS Name" /C:"OS Version"
  - sh: type system_profiler && system_profiler SPSoftwareDataType SPHardwareDataType || true
  - sh: type lsb_release && lsb_release -a || true
  - sh: type uname && uname -a || true

build_script:
  - cmd: C:\msys64\usr\bin\bash -lc 'pacman -Syuu --noconfirm'
  - cmd: C:\msys64\usr\bin\bash -lc '$(cygpath ${APPVEYOR_BUILD_FOLDER})/ci/build_windows_deps.sh'
artifacts: {path: '*.pkg.tar.zst'}

deploy:
  - provider: GitHub
    tag: nightly-dev
    auth_token:
      secure: t9BAyR+k93XD/dXN/gaOgApdGKOxb4lvDtpci8pHHxghvSxd/wNGdFFe/N9WqZSr
    artifact: /.*.pkg.tar.zst/
    prerelease: true
    force_update: true
